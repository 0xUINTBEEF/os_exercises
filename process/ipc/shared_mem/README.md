# Shared memory usage with C (System V IPC)

This folder contains an example to how to use shared memory IPC with C.

## How to run

1. To create a shared memory segment and write to it, we will run [shared_mem_writer.c](shared_mem_writer.c) first. To compile and run it, use the following commands:

```bash
gcc shared_mem_writer.c -o writer.out
./writer.out
```

2. After running the writer, we will run [shared_mem_reader.c](shared_mem_reader.c) to read from the shared memory segment. To compile and run it, use the following commands:

```bash
gcc shared_mem_reader.c -o reader.out
./reader.out
```

**Note:** Reader deletes the shared memory segment after reading from it. If you want to keep the shared memory segment, comment the `shmctl` call at the end.

## How it works

Shared memory is a memory segment that is shared between **multiple processes**.

In this example, we have two programs: `shared_mem_writer.c` and `shared_mem_reader.c`. The writer program creates a shared memory segment and writes a message to it. The reader program reads the message from the shared memory segment.

### Functions

- `ftok()`: Generates a unique key for System V IPC mechanisms.
  Parameters:
  - `pathname`: Pathname to generate the key. (this path must refer to an existing and accessible file)
  - `proj_id`: Project ID. (can be any non-negative integer)
  **The result is the same for all processes that use the same `pathname` and `proj_id`.**
- `shmget()`: Allocates or finds a shared memory segment.
  Parameters:
  - `key`: Key generated by `ftok()`.
  - `size`: Size of the shared memory segment.
  - `shmflg`: Flags to control the allocation of the shared memory segment.
    - `IPC_CREAT`: Create the shared memory segment if it does not exist.
    - `IPC_EXCL`: Return an error if the shared memory segment already exists. (ensures the memory segment is newly created)
    - _Permission flags_ (e.g., `0666`).
    - `SHM_HUGETLB`: Use huge pages.
- `shmat()`: Attaches the shared memory segment to the address space of the calling process. (name comes from "**sh**ared **m**emory **at**tach")
    Parameters:
  - `shmid`: Shared memory ID returned by `shmget()`.
  - `shmaddr`: Address to attach the shared memory segment. (usually `NULL`)
  - `shmflg`: Flags to control the attachment of the shared memory segment.
    - `SHM_RDONLY`: Attach the shared memory segment for reading only.
    - `SHM_EXEC`: Make the shared memory segment executable.
- `shmdt()`: Detaches the shared memory segment from the address space of the calling process. (name comes from "**sh**ared **m**emory **d**e**t**ach")
    Parameters:
  - `shmaddr`: Address of the shared memory segment. (usually the address returned by `shmat()`)
- `shmctl()`: Performs control operations on the shared memory segment.
    Parameters:
  - `shmid`: Shared memory ID returned by `shmget()`.
  - `cmd`: Command to perform.
    - `IPC_RMID`: Remove the shared memory segment.
    - `IPC_STAT`: Get the status of the shared memory segment.
    - `IPC_SET`: Set the status of the shared memory segment.
    - `SHM_LOCK`: Lock the shared memory segment.
    - `SHM_UNLOCK`: Unlock the shared memory segment.
  - `buf`: Buffer to store the status of the shared memory segment.